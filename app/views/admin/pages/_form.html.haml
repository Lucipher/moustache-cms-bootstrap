#content_inner_wrapper
= form_for([:admin, page], :html => { :class => "site_prop", :autocomplete => :off }) do |f|
  = render :partial => "shared/error_messages", 
           :locals => { :target => page }
  %fieldset
    = f.label :parent_id
    = f.collection_select :parent_id, Page.all.order(:title), :id, :title, { :include_blank => true }
  %fieldset
    = f.label :name, "Name"
    = f.text_field :name
  %fieldset
    = f.label :title, "Title"
    = f.text_field :title
  %fieldset
    = f.label :slug, "Path Name"
    = f.text_field :slug
  %fieldset
    = f.label :breadcrumb, "Breadcrumb"
    = f.text_field :breadcrumb
  - if @page.permalink
    = f.label :permalink
    = f.text_field :permalink
  = f.fields_for :meta_data, hash_to_open_struct(@page.meta_data) do |os|
    - os.object.marshal_dump.each_key do |key|
      %fieldset 
        = os.label key
        = os.text_field key
  %fieldset{:class => "inline"}
    = f.label :editors, "Editors"
    - User.all.each do |user|
      = check_box_tag "page[editor_ids][]", user.id, page.editor_ids.include?(user.id), :id => "editor_id_#{user.puid}"
      = label_tag "page[editor_ids][#{user.puid}]", user.puid.downcase
  %fieldset{:class => "inline"}
    = f.label :layout, "Layout"
    = f.collection_select :layout_id, Layout.all, :id, :name
  = f.fields_for :current_state do |builder|
    %fieldset{:class => "inline"}
      = builder.label :current_state, "Status"
      = builder.collection_select :name, CurrentState.all, :id, :name
  - if !@page.parent.try(:post_container?)
    %fieldset{:class => "inline"} 
      = f.label :post_container
      = f.check_box :post_container
  = f.fields_for :page_parts do |builder|
    %fieldset.page_contents
      %fieldset
        = builder.label :name, "Page Part Name"
        = builder.text_field :name
      %fieldset{:class => "inline"}
        = builder.label :filter_name, "Filter"
        = builder.collection_select :filter_name, Filter.all_page_filters, :id, :name
      %fieldset
      = builder.label :content, "Page Part Content"
      = builder.text_area :content
  %fieldset
    = f.submit button_label
    = link_to "Cancel", [:admin, :pages]
